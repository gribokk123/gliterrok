<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Example</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        #messages {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        #messages li {
            padding: 5px 10px;
            border-bottom: 1px solid #eee;
        }

        #input-container {
            padding: 10px;
            background-color: #fff;
            border-top: 1px solid #ccc;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
        }

        #message-input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 10px;
        }

        #send-button {
            padding: 8px 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #notification-container {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }

        .notification {
            padding: 10px 20px;
            margin-bottom: 10px;
            border-radius: 5px;
            color: white;
        }

        .success {
            background-color: #28a745;
        }

        .warning {
            background-color: #ffc107;
            color: black;
        }

        .error {
            background-color: #dc3545;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-section {
            margin-bottom: 25px;
        }

        .settings-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .settings-option {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-option label {
            font-weight: 600;
            color: #333;
        }

        .theme-selector, .style-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .theme-option, .style-option {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .theme-option.selected, .style-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        /* –ú–∞–≥–∞–∑–∏–Ω */
        .shop-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .shop-category {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .shop-category.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .shop-category-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .shop-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid #e9ecef;
        }

        .shop-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .shop-item.owned {
            border-color: #27ae60;
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
        }

        .shop-item-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .shop-item-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .shop-item-price {
            color: #667eea;
            font-weight: 600;
        }

        .shop-item-price.free {
            color: #27ae60;
        }

        /* –¢–µ–º—ã */
        .theme-dark {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        .theme-dark .container {
            background: #34495e;
            color: white;
        }

        .theme-dark .form-card,
        .theme-dark .menu-card,
        .theme-dark .room-card,
        .theme-dark .player-card,
        .theme-dark .chat-message {
            background: #2c3e50;
            color: white;
        }

        .theme-neon {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
        }

        .theme-neon .container {
            background: #16213e;
            color: #00ff88;
            border: 2px solid #00ff88;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }

        /* –ê–≤–∞—Ç–∞—Ä–∫–∏ */
        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .avatar-option {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .avatar-option:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .avatar-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .avatar-option.locked {
            opacity: 0.5;
            cursor: not-allowed;
            position: relative;
        }

        .avatar-option.locked::after {
            content: 'üîí';
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: #e74c3c;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
        .image-upload-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px 20px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .upload-area:hover {
            border-color: #5a6fd8;
            background: #f8f9ff;
        }

        .upload-area.dragover {
            border-color: #27ae60;
            background: #f0f9f0;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #667eea;
        }

        .upload-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 12px;
            color: #999;
        }

        .image-preview {
            margin: 20px 0;
            display: none;
        }

        .preview-container {
            position: relative;
            display: inline-block;
        }

        .preview-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #667eea;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .remove-image {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .custom-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .custom-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .custom-avatar.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        /* –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è —Ñ–∞–π–ª–æ–≤ */
        .hidden-file-input {
            display: none;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º */
        .image-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .image-controls button {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-crop {
            background: #667eea;
            color: white;
        }

        .btn-crop:hover {
            background: #5a6fd8;
        }

        .btn-remove {
            background: #e74c3c;
            color: white;
        }

        .btn-remove:hover {
            background: #c0392b;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –Ω–∏–∫–Ω–µ–π–º–æ–≤ */
        .nickname-container {
            position: relative;
            display: inline-block;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        /* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∏–ª—å */
        .nickname-default {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #333;
            border: 2px solid #dee2e6;
        }

        /* –ù–µ–æ–Ω–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
        .nickname-neon {
            background: #000;
            color: #00ff88;
            border: 2px solid #00ff88;
            box-shadow:
                0 0 10px #00ff88,
                0 0 20px #00ff88,
                0 0 30px #00ff88;
            animation: neonPulse 2s infinite alternate;
        }

        @keyframes neonPulse {
            from { box-shadow: 0 0 10px #00ff88, 0 0 20px #00ff88, 0 0 30px #00ff88; }
            to { box-shadow: 0 0 20px #00ff88, 0 0 30px #00ff88, 0 0 40px #00ff88; }
        }

        /* –û–≥–Ω–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
        .nickname-fire {
            background: linear-gradient(45deg, #ff6b35, #f7931e, #ffcc02);
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: fireFlicker 1.5s infinite alternate;
            border: 2px solid #ff6b35;
        }

        @keyframes fireFlicker {
            0% { background: linear-gradient(45deg, #ff6b35, #f7931e, #ffcc02); }
            50% { background: linear-gradient(45deg, #f7931e, #ffcc02, #ff6b35); }
            100% { background: linear-gradient(45deg, #ffcc02, #ff6b35, #f7931e); }
        }

        /* –õ–µ–¥—è–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç */
        .nickname-ice {
            background: linear-gradient(135deg, #a8e6cf, #7fcdcd, #81c7d4);
            color: #2c3e50;
            border: 2px solid #7fcdcd;
            box-shadow: 0 0 15px rgba(127, 205, 205, 0.5);
            animation: iceShimmer 3s infinite;
        }

        @keyframes iceShimmer {
            0%, 100% { box-shadow: 0 0 15px rgba(127, 205, 205, 0.5); }
            50% { box-shadow: 0 0 25px rgba(127, 205, 205, 0.8); }
        }

        /* –ì–ª–∏—Ç—á —ç—Ñ—Ñ–µ–∫—Ç */
        .nickname-glitch {
            background: #000;
            color: #fff;
            border: 2px solid #ff0080;
            position: relative;
            animation: glitchBg 0.3s infinite;
        }

        .nickname-glitch::before,
        .nickname-glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            padding: 8px 12px;
            box-sizing: border-box;
        }

        .nickname-glitch::before {
            animation: glitchTop 0.3s infinite;
            clip-path: polygon(0 0, 100% 0, 100% 33%, 0 33%);
            color: #ff0080;
        }

        .nickname-glitch::after {
            animation: glitchBottom 0.3s infinite;
            clip-path: polygon(0 67%, 100% 67%, 100% 100%, 0 100%);
            color: #00ffff;
        }

        @keyframes glitchTop {
            0% { transform: translateX(0); }
            20% { transform: translateX(-2px); }
            40% { transform: translateX(2px); }
            60% { transform: translateX(-2px); }
            80% { transform: translateX(2px); }
            100% { transform: translateX(0); }
        }

        @keyframes glitchBottom {
            0% { transform: translateX(0); }
            20% { transform: translateX(2px); }
            40% { transform: translateX(-2px); }
            60% { transform: translateX(2px); }
            80% { transform: translateX(-2px); }
            100% { transform: translateX(0); }
        }

        @keyframes glitchBg {
            0% { background: #000; }
            10% { background: #ff0080; }
            20% { background: #000; }
            30% { background: #00ffff; }
            40% { background: #000; }
            100% { background: #000; }
        }

        /* –†–∞–¥—É–∂–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
        .nickname-rainbow {
            background: linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #80ff00, #00ff00, #00ff80, #00ffff, #0080ff, #0000ff, #8000ff, #ff00ff, #ff0080);
            background-size: 400% 400%;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation: rainbowShift 3s ease infinite;
            border: 2px solid #fff;
        }

        @keyframes rainbowShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* –ó–æ–ª–æ—Ç–æ–π —ç—Ñ—Ñ–µ–∫—Ç */
        .nickname-gold {
            background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
            color: #8b4513;
            border: 2px solid #ffd700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: goldShine 2s infinite;
        }

        @keyframes goldShine {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        }

        /* –ú–∞—Ç—Ä–∏—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
        .nickname-matrix {
            background: #000;
            color: #00ff00;
            border: 2px solid #00ff00;
            font-family: 'Courier New', monospace;
            animation: matrixFlicker 0.1s infinite;
            text-shadow: 0 0 10px #00ff00;
        }

        @keyframes matrixFlicker {
            0% { opacity: 1; }
            98% { opacity: 1; }
            99% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        /* –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç */
        .nickname-space {
            background: linear-gradient(45deg, #0f0f23, #1a1a2e, #16213e);
            color: #fff;
            border: 2px solid #4a69bd;
            position: relative;
            overflow: hidden;
        }

        .nickname-space::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, transparent 20%, rgba(255,255,255,0.1) 21%, rgba(255,255,255,0.1) 34%, transparent 35%, transparent),
                        linear-gradient(0deg, transparent 24%, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.05) 26%, transparent 27%, transparent 74%, rgba(255,255,255,0.05) 75%, rgba(255,255,255,0.05) 76%, transparent 77%, transparent);
            animation: spaceMove 20s linear infinite;
        }

        @keyframes spaceMove {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* –õ–∞–≤–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
        .nickname-lava {
            background: linear-gradient(45deg, #8B0000, #FF4500, #FF6347, #FF0000);
            background-size: 400% 400%;
            color: #fff;
            border: 2px solid #FF4500;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation: lavaFlow 4s ease infinite;
            box-shadow: 0 0 20px rgba(255, 69, 0, 0.6);
        }

        @keyframes lavaFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* –ö–∏–±–µ—Ä —ç—Ñ—Ñ–µ–∫—Ç */
        .nickname-cyber {
            background: linear-gradient(45deg, #0a0a0a, #1a1a1a);
            color: #00d4ff;
            border: 2px solid #00d4ff;
            position: relative;
            text-shadow: 0 0 10px #00d4ff;
            animation: cyberPulse 1.5s infinite;
        }

        .nickname-cyber::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.4), transparent);
            animation: cyberScan 2s infinite;
        }

        @keyframes cyberPulse {
            0%, 100% { box-shadow: 0 0 10px #00d4ff; }
            50% { box-shadow: 0 0 20px #00d4ff, 0 0 30px #00d4ff; }
        }

        @keyframes cyberScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* –ú–∞–≥–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç */
        .nickname-magic {
            background: linear-gradient(45deg, #4a148c, #7b1fa2, #9c27b0, #e91e63);
            background-size: 400% 400%;
            color: #fff;
            border: 2px solid #e91e63;
            text-shadow: 0 0 10px rgba(233, 30, 99, 0.8);
            animation: magicSparkle 3s ease infinite;
            position: relative;
        }

        .nickname-magic::after {
            content: '‚ú®';
            position: absolute;
            top: -10px;
            right: -10px;
            animation: sparkleRotate 2s infinite;
        }

        @keyframes magicSparkle {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes sparkleRotate {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* –¢–∏—Ç—É–ª—ã */
        .nickname-title {
            position: relative;
        }

        .nickname-title::before {
            content: attr(data-title);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            background: rgba(0,0,0,0.8);
            color: #ffd700;
            padding: 2px 6px;
            border-radius: 4px;
            white-space: nowrap;
        }

        /* –†–∞–º–∫–∏ */
        .nickname-frame-diamond {
            border: 3px solid;
            border-image: linear-gradient(45deg, #ffd700, #fff, #ffd700, #fff) 1;
            position: relative;
        }

        .nickname-frame-diamond::before {
            content: 'üíé';
            position: absolute;
            top: -8px;
            left: -8px;
            font-size: 16px;
        }

        .nickname-frame-crown {
            border: 3px solid #ffd700;
            position: relative;
        }

        .nickname-frame-crown::before {
            content: 'üëë';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
        }

        .nickname-frame-fire {
            border: 3px solid #ff4500;
            position: relative;
        }

        .nickname-frame-fire::before,
        .nickname-frame-fire::after {
            content: 'üî•';
            position: absolute;
            top: -10px;
            font-size: 16px;
            animation: fireFlicker 1s infinite alternate;
        }

        .nickname-frame-fire::before {
            left: -10px;
        }

        .nickname-frame-fire::after {
            right: -10px;
        }
    </style>
</head>
<body>
    <h1>WebSocket Chat</h1>
    <ul id="messages"></ul>
    <div id="input-container">
        <input type="text" id="message-input" placeholder="Type your message...">
        <button id="send-button">Send</button>
    </div>
    <div id="notification-container"></div>

    <!-- –°–µ–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="section" id="settingsSection">
        <div class="settings-section">
            <h3>üé® –¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h3>
            <div class="settings-option">
                <div>
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É:</label>
                    <div class="theme-selector">
                        <div class="theme-option selected" data-theme="default" onclick="changeTheme('default')">
                            <div style="font-size: 20px;">üåü</div>
                            <div>–°—Ç–∞–Ω–¥–∞—Ä—Ç</div>
                        </div>
                        <div class="theme-option" data-theme="dark" onclick="changeTheme('dark')">
                            <div style="font-size: 20px;">üåô</div>
                            <div>–¢–µ–º–Ω–∞—è</div>
                        </div>
                        <div class="theme-option" data-theme="neon" onclick="changeTheme('neon')">
                            <div style="font-size: 20px;">‚ö°</div>
                            <div>–ù–µ–æ–Ω</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="settings-section">
            <h3>üé≠ –°—Ç–∏–ª—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h3>
            <div class="settings-option">
                <div>
                    <label>–ê–Ω–∏–º–∞—Ü–∏–∏:</label>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="animationsEnabled" checked onchange="toggleAnimations()">
                            <span>–í–∫–ª—é—á–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="settings-option">
                <div>
                    <label>–ó–≤—É–∫–∏:</label>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="soundsEnabled" checked onchange="toggleSounds()">
                            <span>–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–∏</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <button class="btn btn-success" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞ -->
    <div class="section" id="shopSection">
        <div class="shop-categories">
            <div class="shop-category active" data-category="styles" onclick="showShopCategory('styles')">
                <span class="shop-category-icon">üé®</span>
                <div>–°—Ç–∏–ª–∏</div>
            </div>
            <div class="shop-category" data-category="frames" onclick="showShopCategory('frames')">
                <span class="shop-category-icon">üñºÔ∏è</span>
                <div>–†–∞–º–∫–∏</div>
            </div>
            <div class="shop-category" data-category="titles" onclick="showShopCategory('titles')">
                <span class="shop-category-icon">üèÜ</span>
                <div>–¢–∏—Ç—É–ª—ã</div>
            </div>
            <div class="shop-category" data-category="avatars" onclick="showShopCategory('avatars')">
                <span class="shop-category-icon">üë§</span>
                <div>–ê–≤–∞—Ç–∞—Ä–∫–∏</div>
            </div>
        </div>
        
        <div class="shop-items" id="shopItems">
            <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –∞–≤–∞—Ç–∞—Ä–æ–∫ -->
    <div class="section" id="avatarsSection">
        <div class="image-upload-section">
            <h3 style="margin-bottom: 20px; color: #333;">üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ—é –∞–≤–∞—Ç–∞—Ä–∫—É</h3>
            
            <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üì∑</div>
                <div class="upload-text">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</div>
                <div class="upload-hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, GIF (–º–∞–∫—Å. 5MB)</div>
            </div>
            
            <input type="file" id="fileInput" class="hidden-file-input" accept="image/*" onchange="handleFileSelect(event)">
            
            <div class="image-preview" id="imagePreview">
                <div class="preview-container">
                    <img id="previewImage" class="preview-image" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
                    <button class="remove-image" onclick="removePreviewImage()">√ó</button>
                </div>
                <div class="image-controls">
                    <button class="btn-crop" onclick="cropAndSaveImage()">‚úÇÔ∏è –û–±—Ä–µ–∑–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn-remove" onclick="removePreviewImage()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <div class="form-card">
            <h2 style="margin-bottom: 20px; text-align: center; color: #333;">–í—ã–±–æ—Ä –∞–≤–∞—Ç–∞—Ä–∫–∏</h2>
            
            <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ -->
            <div id="customAvatarsSection" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #333;">üñºÔ∏è –í–∞—à–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏</h3>
                <div class="avatar-grid" id="customAvatarGrid">
                    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ -->
                </div>
            </div>
            
            <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ -->
            <h3 style="margin-bottom: 15px; color: #333;">üé≠ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä–∫–∏</h3>
            <div class="avatar-grid" id="avatarGrid">
                <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ -->
            </div>
            
            <button class="btn" onclick="saveAvatar()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–±–æ—Ä</button>
        </div>
    </div>

    <div class="nickname-preview-section">
        <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∏–∫–Ω–µ–π–º–∞:</h3>
        <div id="nicknamePreview" style="text-align: center; margin: 20px 0; font-size: 18px;">
            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∏–∫–Ω–µ–π–º–∞ —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ -->
        </div>
    </div>

    <script>
        // –î–æ–±–∞–≤–∏–º –≤ –Ω–∞—á–∞–ª–æ JavaScript —Å–µ–∫—Ü–∏–∏
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;
        let reconnectTimeout;
        let heartbeatInterval;

        const SERVER_URL = 'ws://localhost:8080'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
        let ws;
        let currentUser = 'User-' + Math.floor(Math.random() * 1000); // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
        let selectedAvatarType = 'emoji'; // 'emoji' –∏–ª–∏ 'custom'
        let selectedAvatarValue = 'üé≠';
        let customAvatars = JSON.parse(localStorage.getItem('customAvatars') || '[]');

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function setupImageUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            // Drag & Drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
            if (!file.type.startsWith('image/')) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (5MB)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                showImagePreview(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        function showImagePreview(imageSrc) {
            const preview = document.getElementById('imagePreview');
            const previewImage = document.getElementById('previewImage');
            
            previewImage.src = imageSrc;
            preview.style.display = 'block';
        }

        function removePreviewImage() {
            const preview = document.getElementById('imagePreview');
            const previewImage = document.getElementById('previewImage');
            const fileInput = document.getElementById('fileInput');
            
            preview.style.display = 'none';
            previewImage.src = '';
            fileInput.value = '';
        }

        function cropAndSaveImage() {
            const previewImage = document.getElementById('previewImage');
            if (!previewImage.src) {
                showNotification('–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!', 'error');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º canvas –¥–ª—è –æ–±—Ä–µ–∑–∫–∏
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const size = 150; // –†–∞–∑–º–µ—Ä –∞–≤–∞—Ç–∞—Ä–∫–∏
            
            canvas.width = size;
            canvas.height = size;
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const img = new Image();
            img.onload = function() {
                // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –æ–±—Ä–µ–∑–∫–∏ –≤ –∫–≤–∞–¥—Ä–∞—Ç
                const minSize = Math.min(img.width, img.height);
                const x = (img.width - minSize) / 2;
                const y = (img.height - minSize) / 2;
                
                // –°–æ–∑–¥–∞–µ–º –∫—Ä—É–≥–ª—É—é –º–∞—Å–∫—É
                ctx.beginPath();
                ctx.arc(size/2, size/2, size/2, 0, Math.PI * 2);
                ctx.clip();
                
                // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                ctx.drawImage(img, x, y, minSize, minSize, 0, 0, size, size);
                
                // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const croppedImageData = canvas.toDataURL('image/png');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É
                saveCustomAvatar(croppedImageData);
            };
            
            img.src = previewImage.src;
        }

        function saveCustomAvatar(imageData) {
            const avatarId = 'custom_' + Date.now();
            const newAvatar = {
                id: avatarId,
                data: imageData,
                createdAt: new Date().toISOString()
            };
            
            customAvatars.push(newAvatar);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∞–≤–∞—Ç–∞—Ä–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10)
            if (customAvatars.length > 10) {
                customAvatars = customAvatars.slice(-10);
            }
            
            localStorage.setItem('customAvatars', JSON.stringify(customAvatars));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            loadCustomAvatars();
            removePreviewImage();
            
            showNotification('–ê–≤–∞—Ç–∞—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 'success');
        }

        function loadCustomAvatars() {
            const container = document.getElementById('customAvatarGrid');
            const section = document.getElementById('customAvatarsSection');
            
            if (customAvatars.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            
            container.innerHTML = customAvatars.map(avatar => `
                <div class="avatar-option ${selectedAvatarType === 'custom' && selectedAvatarValue === avatar.id ? 'selected' : ''}" 
                     onclick="selectCustomAvatar('${avatar.id}')">
                    <img src="${avatar.data}" class="custom-avatar" alt="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞">
                </div>
            `).join('');
        }

        function selectCustomAvatar(avatarId) {
            // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∞–≤–∞—Ç–∞—Ä–æ–∫
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é
            event.target.closest('.avatar-option').classList.add('selected');
            
            selectedAvatarType = 'custom';
            selectedAvatarValue = avatarId;
        }

        function connectWebSocket() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                return;
            }

            ws = new WebSocket(SERVER_URL);
            
            ws.onopen = function() {
                console.log('WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω');
                reconnectAttempts = 0;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                if (currentUser) {
                    ws.send(JSON.stringify({
                        type: 'user_connected',
                        user: currentUser
                    }));
                }
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º heartbeat
                startHeartbeat();
                
                showNotification('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
            };
            
            ws.onclose = function() {
                console.log('WebSocket –æ—Ç–∫–ª—é—á–µ–Ω');
                stopHeartbeat();
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                if (reconnectAttempts < maxReconnectAttempts) {
                    reconnectAttempts++;
                    const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 30000);
                    
                    showNotification(`–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ${delay/1000} —Å–µ–∫...`, 'warning');
                    
                    reconnectTimeout = setTimeout(() => {
                        connectWebSocket();
                    }, delay);
                } else {
                    showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                }
            };
            
            ws.onerror = function(error) {
                console.error('WebSocket –æ—à–∏–±–∫–∞:', error);
            };

            ws.onmessage = function(event) {
                const message = JSON.parse(event.data);

                switch (message.type) {
                    case 'chat':
                        addMessage(message.user, message.text);
                        break;
                    case 'user_connected':
                        showNotification(message.user + ' –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è', 'success');
                        break;
                    case 'pong':
                        // –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ ping
                        break;
                    default:
                        console.log('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è:', message);
                }
            };
        }

        function startHeartbeat() {
            heartbeatInterval = setInterval(() => {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({ type: 'ping' }));
                }
            }, 25000); // –ö–∞–∂–¥—ã–µ 25 —Å–µ–∫—É–Ω–¥
        }

        function stopHeartbeat() {
            if (heartbeatInterval) {
                clearInterval(heartbeatInterval);
                heartbeatInterval = null;
            }
        }

        function addMessage(user, text) {
            const messageElement = document.createElement('li');
            messageElement.textContent = user + ': ' + text;
            document.getElementById('messages').appendChild(messageElement);
        }

        function sendMessage() {
            const messageInput = document.getElementById('message-input');
            const text = messageInput.value;
            if (text) {
                ws.send(JSON.stringify({
                    type: 'chat',
                    user: currentUser,
                    text: text
                }));
                messageInput.value = '';
            }
        }

        function showNotification(message, type) {
            const notificationContainer = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.classList.add('notification', type);
            notification.textContent = message;
            notificationContainer.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function showSettings() {
            showSection('settingsSection');
            loadSettings();
        }

        function showShop() {
            showSection('shopSection');
            loadShopItems('avatars');
        }

        function showAvatars() {
            showSection('avatarsSection');
            loadAvatars();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function changeTheme(theme) {
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-theme="${theme}"]`).classList.add('selected');
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
            document.body.className = theme !== 'default' ? `theme-${theme}` : '';
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('selectedTheme', theme);
        }

        function toggleAnimations() {
            const enabled = document.getElementById('animationsEnabled').checked;
            if (!enabled) {
                document.body.style.setProperty('--animation-duration', '0s');
            } else {
                document.body.style.removeProperty('--animation-duration');
            }
            localStorage.setItem('animationsEnabled', enabled);
        }

        function toggleSounds() {
            const enabled = document.getElementById('soundsEnabled').checked;
            localStorage.setItem('soundsEnabled', enabled);
        }

        function saveSettings() {
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
        }

        function loadSettings() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const theme = localStorage.getItem('selectedTheme') || 'default';
            const animations = localStorage.getItem('animationsEnabled') !== 'false';
            const sounds = localStorage.getItem('soundsEnabled') !== 'false';
            
            changeTheme(theme);
            document.getElementById('animationsEnabled').checked = animations;
            document.getElementById('soundsEnabled').checked = sounds;
            
            if (!animations) {
                document.body.style.setProperty('--animation-duration', '0s');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞
        const shopData = {
            avatars: [
                { id: 'av1', icon: 'üé≠', name: '–ú–∞—Å–∫–∞', price: 0, owned: true },
                { id: 'av2', icon: 'üë§', name: '–ß–µ–ª–æ–≤–µ–∫', price: 0, owned: true },
                { id: 'av3', icon: 'üïµÔ∏è', name: '–î–µ—Ç–µ–∫—Ç–∏–≤', price: 0, owned: true },
                { id: 'av4', icon: 'üëë', name: '–ö–æ—Ä–æ–ª—å', price: 0, owned: true },
                { id: 'av5', icon: 'üé™', name: '–¶–∏—Ä–∫', price: 0, owned: true },
                { id: 'av6', icon: 'üéØ', name: '–ú–∏—à–µ–Ω—å', price: 0, owned: true },
                { id: 'av7', icon: 'ü¶π', name: '–ó–ª–æ–¥–µ–π', price: 0, owned: true },
                { id: 'av8', icon: 'üßô', name: '–ú–∞–≥', price: 0, owned: true },
                { id: 'av9', icon: 'ü§ñ', name: '–†–æ–±–æ—Ç', price: 0, owned: true },
                { id: 'av10', icon: 'üëª', name: '–ü—Ä–∏–∑—Ä–∞–∫', price: 0, owned: true },
                { id: 'av11', icon: 'üê∫', name: '–í–æ–ª–∫', price: 0, owned: true },
                { id: 'av12', icon: 'ü¶ä', name: '–õ–∏—Å–∞', price: 0, owned: true }
            ],
            frames: [
                { id: 'fr1', icon: 'üî•', name: '–û–≥–Ω–µ–Ω–Ω–∞—è', price: 0, owned: true },
                { id: 'fr2', icon: '‚ùÑÔ∏è', name: '–õ–µ–¥—è–Ω–∞—è', price: 0, owned: true },
                { id: 'fr3', icon: '‚ö°', name: '–ú–æ–ª–Ω–∏—è', price: 0, owned: true },
                { id: 'fr4', icon: 'üåü', name: '–ó–≤–µ–∑–¥–Ω–∞—è', price: 0, owned: true }
            ],
            titles: [
                { id: 'ti1', icon: 'üëë', name: '–ú–∞—Å—Ç–µ—Ä', price: 0, owned: true },
                { id: 'ti2', icon: 'üèÜ', name: '–ß–µ–º–ø–∏–æ–Ω', price: 0, owned: true },
                { id: 'ti3', icon: '‚≠ê', name: '–õ–µ–≥–µ–Ω–¥–∞', price: 0, owned: true },
                { id: 'ti4', icon: 'üíé', name: '–≠–ª–∏—Ç–∞', price: 0, owned: true }
            ],
            effects: [
                { id: 'ef1', icon: '‚ú®', name: '–ë–ª–µ—Å–∫', price: 0, owned: true },
                { id: 'ef2', icon: 'üåà', name: '–†–∞–¥—É–≥–∞', price: 0, owned: true },
                { id: 'ef3', icon: 'üí´', name: '–ó–≤–µ–∑–¥—ã', price: 0, owned: true },
                { id: 'ef4', icon: 'üîÆ', name: '–ú–∞–≥–∏—è', price: 0, owned: true }
            ]
        };

        // –î–∞–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –¥–ª—è –Ω–∏–∫–Ω–µ–π–º–æ–≤
        const nicknameEffects = {
            styles: [
                { id: 'default', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç', class: 'nickname-default', price: 0, owned: true },
                { id: 'neon', name: '–ù–µ–æ–Ω', class: 'nickname-neon', price: 0, owned: true },
                { id: 'fire', name: '–û–≥–æ–Ω—å', class: 'nickname-fire', price: 0, owned: true },
                { id: 'ice', name: '–õ—ë–¥', class: 'nickname-ice', price: 0, owned: true },
                { id: 'glitch', name: '–ì–ª–∏—Ç—á', class: 'nickname-glitch', price: 0, owned: true },
                { id: 'rainbow', name: '–†–∞–¥—É–≥–∞', class: 'nickname-rainbow', price: 0, owned: true },
                { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ', class: 'nickname-gold', price: 0, owned: true },
                { id: 'matrix', name: '–ú–∞—Ç—Ä–∏—Ü–∞', class: 'nickname-matrix', price: 0, owned: true },
                { id: 'space', name: '–ö–æ—Å–º–æ—Å', class: 'nickname-space', price: 0, owned: true },
                { id: 'lava', name: '–õ–∞–≤–∞', class: 'nickname-lava', price: 0, owned: true },
                { id: 'cyber', name: '–ö–∏–±–µ—Ä', class: 'nickname-cyber', price: 0, owned: true },
                { id: 'magic', name: '–ú–∞–≥–∏—è', class: 'nickname-magic', price: 0, owned: true }
            ],
            frames: [
                { id: 'none', name: '–ë–µ–∑ —Ä–∞–º–∫–∏', class: '', price: 0, owned: true },
                { id: 'diamond', name: '–ê–ª–º–∞–∑', class: 'nickname-frame-diamond', price: 0, owned: true },
                { id: 'crown', name: '–ö–æ—Ä–æ–Ω–∞', class: 'nickname-frame-crown', price: 0, owned: true },
                { id: 'fire', name: '–û–≥–Ω–µ–Ω–Ω–∞—è', class: 'nickname-frame-fire', price: 0, owned: true }
            ],
            titles: [
                { id: 'none', name: '–ë–µ–∑ —Ç–∏—Ç—É–ª–∞', title: '', price: 0, owned: true },
                { id: 'master', name: '–ú–∞—Å—Ç–µ—Ä', title: 'üëë –ú–ê–°–¢–ï–†', price: 0, owned: true },
                { id: 'legend', name: '–õ–µ–≥–µ–Ω–¥–∞', title: '‚≠ê –õ–ï–ì–ï–ù–î–ê', price: 0, owned: true },
                { id: 'champion', name: '–ß–µ–º–ø–∏–æ–Ω', title: 'üèÜ –ß–ï–ú–ü–ò–û–ù', price: 0, owned: true },
                { id: 'elite', name: '–≠–ª–∏—Ç–∞', title: 'üíé –≠–õ–ò–¢–ê', price: 0, owned: true }
            ]
        };

        // –¢–µ–∫—É—â–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        let selectedNicknameStyle = 'default';
        let selectedNicknameFrame = 'none';
        let selectedNicknameTitle = 'none';

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∫ –Ω–∏–∫–Ω–µ–π–º—É
        function applyNicknameEffects(nickname, style, frame, title) {
            const styleData = nicknameEffects.styles.find(s => s.id === style);
            const frameData = nicknameEffects.frames.find(f => f.id === frame);
            const titleData = nicknameEffects.titles.find(t => t.id === title);
            
            let classes = 'nickname-container';
            if (styleData) classes += ' ' + styleData.class;
            if (frameData) classes += ' ' + frameData.class;
            if (titleData && titleData.title) classes += ' nickname-title';
            
            const titleAttr = titleData && titleData.title ? `data-title="${titleData.title}"` : '';
            const textAttr = style === 'glitch' ? `data-text="${nickname}"` : '';
            
            return `<span class="${classes}" ${titleAttr} ${textAttr}>${nickname}</span>`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≤ –º–∞–≥–∞–∑–∏–Ω
        function loadNicknameEffectsShop() {
            const container = document.getElementById('shopItems');
            const activeCategory = document.querySelector('.shop-category.active').dataset.category;
            
            let items = [];
            if (activeCategory === 'styles') {
                items = nicknameEffects.styles;
            } else if (activeCategory === 'frames') {
                items = nicknameEffects.frames;
            } else if (activeCategory === 'titles') {
                items = nicknameEffects.titles;
            }
            
            container.innerHTML = items.map(item => `
                <div class="shop-item ${item.owned ? 'owned' : ''}" onclick="buyNicknameEffect('${item.id}', '${activeCategory}')">
                    <div class="shop-item-preview">
                        ${applyNicknameEffects('–ü—Ä–∏–º–µ—Ä', 
                            activeCategory === 'styles' ? item.id : 'default',
                            activeCategory === 'frames' ? item.id : 'none', 
                            activeCategory === 'titles' ? item.id : 'none'
                        )}
                    </div>
                    <div class="shop-item-name">${item.name}</div>
                    <div class="shop-item-price ${item.price === 0 ? 'free' : ''}">${item.price === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : item.price + ' –º–æ–Ω–µ—Ç'}</div>
                    ${item.owned ? '<div style="color: #27ae60; font-size: 12px; margin-top: 5px;">‚úì –ö—É–ø–ª–µ–Ω–æ</div>' : ''}
                </div>
            `).join('');
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞
        function buyNicknameEffect(effectId, category) {
            const categoryData = nicknameEffects[category];
            const effect = categoryData.find(e => e.id === effectId);
            
            if (!effect) return;
            
            if (effect.owned) {
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç
                if (category === 'styles') {
                    selectedNicknameStyle = effectId;
                } else if (category === 'frames') {
                    selectedNicknameFrame = effectId;
                } else if (category === 'titles') {
                    selectedNicknameTitle = effectId;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä
                localStorage.setItem('selectedNicknameStyle', selectedNicknameStyle);
                localStorage.setItem('selectedNicknameFrame', selectedNicknameFrame);
                localStorage.setItem('selectedNicknameTitle', selectedNicknameTitle);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                updateNicknamePreview();
                showNotification(`–≠—Ñ—Ñ–µ–∫—Ç "${effect.name}" –ø—Ä–∏–º–µ–Ω—ë–Ω!`, 'success');
                
                return;
            }
            
            // –ü–æ–∫—É–ø–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç (–ø–æ–∫–∞ –≤—Å–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
            effect.owned = true;
            
            showNotification(`–≠—Ñ—Ñ–µ–∫—Ç "${effect.name}" –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é!`, 'success');
            loadNicknameEffectsShop();
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–∏–∫–Ω–µ–π–º–∞
        function updateNicknamePreview() {
            const previewContainer = document.getElementById('nicknamePreview');
            if (previewContainer && currentUser) {
                previewContainer.innerHTML = applyNicknameEffects(
                    currentUser.nickname || '–ò–≥—Ä–æ–∫',
                    selectedNicknameStyle,
                    selectedNicknameFrame,
                    selectedNicknameTitle
                );
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        function loadNicknameEffects() {
            selectedNicknameStyle = localStorage.getItem('selectedNicknameStyle') || 'default';
            selectedNicknameFrame = localStorage.getItem('selectedNicknameFrame') || 'none';
            selectedNicknameTitle = localStorage.getItem('selectedNicknameTitle') || 'none';
            updateNicknamePreview();
        }

        function showShopCategory(category) {
            document.querySelectorAll('.shop-category').forEach(cat => {
                cat.classList.remove('active');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            if (['styles', 'frames', 'titles'].includes(category)) {
                loadNicknameEffectsShop();
            } else {
                loadShopItems(category);
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –∞–≤–∞—Ç–∞—Ä–æ–∫
        function loadAvatars() {
            const container = document.getElementById('avatarGrid');
            const avatars = shopData.avatars;
            const ownedItems = JSON.parse(localStorage.getItem('ownedItems') || '{}');
            const ownedAvatars = ownedItems.avatars || [];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é –∞–≤–∞—Ç–∞—Ä–∫—É
            let currentAvatar = 'üé≠';
            if (currentUser) {
                if (currentUser.avatarType === 'emoji') {
                    currentAvatar = currentUser.avatar || 'üé≠';
                    selectedAvatarType = 'emoji';
                    selectedAvatarValue = currentAvatar;
                } else if (currentUser.avatarType === 'custom') {
                    selectedAvatarType = 'custom';
                    selectedAvatarValue = currentUser.customAvatarId;
                }
            }
            
            container.innerHTML = avatars.map(avatar => {
                const isOwned = avatar.owned || ownedAvatars.includes(avatar.id);
                const isSelected = selectedAvatarType === 'emoji' && avatar.icon === currentAvatar;
                
                return `
                    <div class="avatar-option ${isSelected ? 'selected' : ''} ${!isOwned ? 'locked' : ''}" 
                         data-avatar="${avatar.icon}" 
                         onclick="${isOwned ? `selectAvatar('${avatar.icon}')` : `showNotification('–ö—É–ø–∏—Ç–µ —ç—Ç—É –∞–≤–∞—Ç–∞—Ä–∫—É –≤ –º–∞–≥–∞–∑–∏–Ω–µ!', 'error')`}">
                        ${avatar.icon}
                    </div>
                `;
            }).join('');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏
            loadCustomAvatars();
        }

        function selectCustomAvatar(avatarId) {
            // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∞–≤–∞—Ç–∞—Ä–æ–∫
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é
            event.target.closest('.avatar-option').classList.add('selected');
            
            selectedAvatarType = 'custom';
            selectedAvatarValue = avatarId;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é selectAvatar –¥–ª—è —ç–º–æ–¥–∑–∏
        function selectAvatar(avatar) {
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-avatar="${avatar}"]`).classList.add('selected');
            
            selectedAvatarType = 'emoji';
            selectedAvatarValue = avatar;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é saveAvatar
        function saveAvatar() {
            if (!selectedAvatarValue) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä–∫—É!', 'error');
                return;
            }
            
            if (currentUser) {
                currentUser.avatarType = selectedAvatarType;
                
                if (selectedAvatarType === 'emoji') {
                    currentUser.avatar = selectedAvatarValue;
                    currentUser.customAvatarId = null;
                } else {
                    currentUser.customAvatarId = selectedAvatarValue;
                    currentUser.avatar = null;
                }
                
                localStorage.setItem('mafiaUser', JSON.stringify(currentUser));
                updateProfileDisplay();
                showNotification('–ê–≤–∞—Ç–∞—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 'success');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function getUserAvatar(user) {
            if (user.avatarType === 'custom' && user.customAvatarId) {
                const customAvatar = customAvatars.find(av => av.id === user.customAvatarId);
                if (customAvatar) {
                    return `<img src="${customAvatar.data}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">`;
                }
            }
            return user.avatar || 'üë§';
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é updateProfileDisplay
        function updateProfileDisplay() {
            if (!currentUser) return;
            
            const profileAvatar = document.getElementById('profileAvatar');
            
            if (currentUser.avatarType === 'custom' && currentUser.customAvatarId) {
                const customAvatar = customAvatars.find(av => av.id === currentUser.customAvatarId);
                if (customAvatar) {
                    profileAvatar.innerHTML = `<img src="${customAvatar.data}" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover;">`;
                } else {
                    profileAvatar.textContent = currentUser.avatar || 'üë§';
                }
            } else {
                profileAvatar.textContent = currentUser.avatar || 'üë§';
            }
            
            document.getElementById('profileNickname').textContent = currentUser.nickname;
            document.getElementById('profileEmail').textContent = currentUser.email || '–ù–µ —É–∫–∞–∑–∞–Ω';
            document.getElementById('gamesPlayed').textContent = currentUser.gamesPlayed || 0;
            document.getElementById('gamesWon').textContent = currentUser.gamesWon || 0;
            
            const winRate = currentUser.gamesPlayed > 0 
                ? Math.round((currentUser.gamesWon / currentUser.gamesPlayed) * 100)
                : 0;
            document.getElementById('winRate').textContent = winRate + '%';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            setupImageUpload();
            loadNicknameEffects();
            // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        });

        connectWebSocket();
        loadSettings();
    </script>
</body>
</html>
